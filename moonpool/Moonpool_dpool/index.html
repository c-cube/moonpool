<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Moonpool_dpool (moonpool.Moonpool_dpool)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../_odoc-theme/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">moonpool</a> &#x00BB; Moonpool_dpool</nav><header class="odoc-preamble"><h1>Module <code><span>Moonpool_dpool</span></code></h1><p>Static pool of domains.</p><p>These domains are shared between <b>all</b> the pools in moonpool. The rationale is that we should not have more domains than cores, so it's easier to reserve exactly that many domain slots, and run more flexible thread pools on top (each domain being shared by potentially multiple threads from multiple pools).</p><p>The pool should not contain actual domains if it's not in use, ie if no runner is presently actively using one or more of the domain slots.</p><p><b>NOTE</b>: Interface is still experimental.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.6</li></ul></header><nav class="odoc-toc"><ul><li><a href="#low-level-interface-for-resouce-handling">Low level interface for resouce handling</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-domain"><a href="#type-domain" class="anchor"></a><code><span><span class="keyword">type</span> domain</span><span> = <a href="../Moonpool_private/Domain_/index.html#type-t">Moonpool_private.Domain_.t</a></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-max_number_of_domains"><a href="#val-max_number_of_domains" class="anchor"></a><code><span><span class="keyword">val</span> max_number_of_domains : <span>unit <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Number of domains in the pool when all domains are active.</p></div></div><h3 id="low-level-interface-for-resouce-handling"><a href="#low-level-interface-for-resouce-handling" class="anchor"></a>Low level interface for resouce handling</h3><p>Be very cautious with this interface, or resource leaks might occur.</p><div class="odoc-spec"><div class="spec value anchored" id="val-run_on"><a href="#val-run_on" class="anchor"></a><code><span><span class="keyword">val</span> run_on : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>run_on i f</code> runs <code>f()</code> on the domain with index <code>i</code>. Precondition: <code>0 &lt;= i &lt; n_domains()</code>. The thread must call <a href="#val-decr_on"><code>decr_on</code></a> with <code>i</code> once it's done.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-decr_on"><a href="#val-decr_on" class="anchor"></a><code><span><span class="keyword">val</span> decr_on : <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Signal that a thread is stopping on the domain with index <code>i</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_on_and_wait"><a href="#val-run_on_and_wait" class="anchor"></a><code><span><span class="keyword">val</span> run_on_and_wait : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>run_on_and_wait i f</code> runs <code>f()</code> on the domain with index <code>i</code>, and blocks until the result of <code>f()</code> is returned back.</p></div></div></div></body></html>
